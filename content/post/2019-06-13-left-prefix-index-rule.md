---
date: "2019-06-13T00:00:00Z"
tags:
- database
- mysql
title: 最左前缀原则
---

数据库的索引有个`最左前缀原则`，英文称为 `Left-Prefix Index Rule`, 意即如果某个表有 `<k1, k2,..., kn>` 的复合键顺序索引，那么它逻辑上同时也有 `<k1>`, `<k1, k2>`, ...,  `<k1, k2, ..., km>` (m < n) 等最左前缀的索引。体现这个原则最好的实物就是英文字典。英文字典是全排序的，所以它对任意长度的前缀也是排序的，我们才能够方便地查找到目标单词。

索引的功能体现在两个方面，一个是点查时可以精准定位，不用全表扫描，一个范围查询时可以缩小查询范围。具体来看一下字典的例子。

比如点查 `b` 开头的第一个单词，就等价于查 `ba` 开头的单词，也等价于查 `baa` 开头的单词（这里作了一点简化，假设一定存在 `baa` 开头的单词）。可以看到，只要前 n 位是有序的，那么前 m(m<n) 位也是有序的。有了前 n 位的复合索引，前 m 位的复合索引和首位的单键索引都是不必要的。

再来看范围查询。查询首字母 `a-c` 的所有单词，就等价于查询前两位字母 `aa-cz` 的所有单词。于是可以得出与点查相同的结论。

再来看为什么 `<k1, k2>` 键不能用于取代 `k2` 键。

查询第二个字母是 `b` 的所有单词，等价于查询 `ab`, `bb`, `cb`, ...., `zb` 开头的单词。虽然一定程度上缩小了数据的范围，但是数据这样分散，并不像前面例子，是一个连续数据段，需要多次查询。在实际数据中，第一个“字母”远不止 26 个，这样的“索引” 意义就很有限了，经常不如全表扫描。

而查询第二个字母是 `b` 的第一个单词，只要查 `ab` 开头的第一个单词，索引看似起到了作用。然而在实际数据中，首位“字母”的最小值并不一定是 `a`, 所以点查时一样不起作用。

最左前缀原则看起来简单，想说清楚还真不容易啊。这里只是用实际例子说明，如果要用数学形式化证明就要费点功夫了。
